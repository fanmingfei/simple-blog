---
layout: post
title: "开始使用 Flow 来进行类型检查"
category: JavaScript
date: 2017-07-28 18:00:00
---

## 介绍

前些日子在拜读 VueJS 源码时发现，VueJS 的源码中给变量和参数声明了类型，这也引起了我在未来项目中使用类型检查工具的想法。本着抄起家伙就是干，在我最新的开源项目中，我引入了 VueJS 使用的 Flow 做类型检查。

众所周知，JavaScript 是弱类型语言，并且类型非常宽松。这使我们在编写 JavaScript 代码的时候非常爽，从来不用去担心 IDE 的类型报错，不需要定义函数接收参数的类型。每一个项目的启动，都是一场狂欢，我们在没有类型约束的语言里荡漾，去放纵，去狂妄。代码日增，功能渐多，迎来了一次又一次的羁绊，我徜徉，我彷徨。

在同一个项目中，现在的你和两个星期之前的你可能不是同一个人。两个星期前我创造了一个函数，这个函数接收一个对象作为参数，我利用传进来的对象做了一系列不可描述的事情，然后返回了一个新的对象。今天，我使用这个函数的时候，突然发现，我已然忘记我将要构造一个什么结构的对象当做参数，也不记得这个函数返回的对象里有哪些属性了。

那么，Flow 是如何做到类型检查的呢？

在 C#/Java 等强类型语言中，所有的变量、属性、参数是需要对其定义类型的，也需要对函数的返回值进行类型定义。这样，在程序编译过程中，编译器就会进行类型检查，如果类型不匹配，将会终止编译。也就是说，变量存储的数据自始至终必须是一种类型、函数接收的变量类型也被固定，如果在调用函数时传递其它类型，编译会被中断。

第一步：

我们要模仿 C#/Java 之类的语言，在编码过程中对类型进行定义。举个例子：

```js
function getStringLength(str: string):number {
    const len: number = str.length;
    return len;
}
```

虽然看起来没有什么用，但可以简单讲述如何定义类型了。这个函数接收一个 `string` 类型的参数，参数名为 `str`，函数的返回值是 `number` 类型。定义了一个类型为 `number` 的常量 `len`，它的值为 `str` 的长度，并且将其返回。

我们写了一段简单的根据 Flow 的规则，进行类型声明的代码。


第二步：

通过 Flow 提供的工具进行类型检查。如果有类型不匹配的地方，工具会提示错误。工具安装和使用方式将会在后文提到。

第三步：
但是，发布到线上的代码是不能加类型声明的，因为这样不符合规范，浏览器也不认。所以，我们需要对源代码进行一次编译，将所有声明的类型去掉，像正常的 JS 代码一样了。

上面的代码编译过后将会变成：

```js
function getStringLength(str) {
    const len = str.length;
    return len;
}
```



## 安装

从上文中，我们可以发现，使用 Flow 至少需要两个东西，一个是检查工具，另外一个是编译器，检查工具类似一个命令行工具，每次需要检查类型的时候就去执行一下。而编译器，就是将你的源码转换成浏览器可读的代码。

